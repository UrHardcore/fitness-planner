<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#22c55e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Rutinas">
<title>Planificador de Rutinas (Lite)</title>
<style>
:root{--bg:#0b0f14;--panel:#11161d;--card:#0e141b;--text:#e7edf3;--muted:#aab4c0;--border:#1f2a37;--accent:#22c55e;--danger:#ef4444}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text);-webkit-tap-highlight-color:transparent;
padding-top:env(safe-area-inset-top);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right)}
.container{max-width:1100px;margin:0 auto;padding:16px}
header{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:10px}
h1{font-size:18px;margin:0}
.btn{background:transparent;border:1px solid var(--border);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
.btn:hover{border-color:var(--accent)}
.btn-accent{background:var(--accent);border-color:transparent;color:white}
input,select,textarea{background:var(--card);border:1px solid var(--border);color:var(--text);border-radius:10px;padding:10px;min-height:44px;font-size:16px}
.grid{display:grid;gap:12px}
@media(min-width:900px){.grid{grid-template-columns:1fr 1.2fr 0.8fr}}
.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
.list{display:flex;flex-direction:column;gap:8px;max-height:60vh;overflow:auto}
.item{display:flex;justify-content:space-between;align-items:center;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:8px}
.tabs{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
.tab{padding:6px 10px;border:1px solid var(--border);background:var(--card);border-radius:10px;cursor:pointer}
.tab.active{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent) inset}
.exercise{border:1px dashed var(--border);border-radius:12px;padding:10px;display:grid;gap:8px}
.ex-row{display:grid;grid-template-columns:1.3fr 1fr 1.2fr .7fr .7fr .9fr .7fr .8fr;gap:6px}
@media(max-width:900px){.ex-row{grid-template-columns:1fr 1fr}}
.footer{margin-top:6px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Planificador de Rutinas (Lite)</h1>
    <div>
      <button class="btn" id="exportBtn">Exportar</button>
      <label class="btn" for="importInput">Importar</label>
      <input id="importInput" type="file" accept="application/json" style="display:none">
      <button class="btn" id="printBtn">Imprimir/PDF</button>
    </div>
  </header>

  <div class="grid">
    <section class="card">
      <h3>Alumnos</h3>
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <input id="studentName" placeholder="Nombre del alumno">
        <button class="btn btn-accent" id="addStudent">Agregar</button>
        <input id="searchStudent" placeholder="Buscar…">
      </div>
      <div id="studentsList" class="list" style="margin-top:8px"></div>
    </section>

    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:end;gap:8px;flex-wrap:wrap">
        <div>
          <h3 id="title">Rutina</h3>
          <div id="subtitle" style="color:var(--muted)">Seleccioná un alumno</div>
        </div>
        <div style="display:flex;gap:6px;align-items:center">
          <select id="weekSelect"></select>
          <button class="btn" id="newWeek">Nueva semana</button>
        </div>
      </div>
      <div style="display:flex;gap:6px;margin-top:6px;flex-wrap:wrap">
        <label>Desde <input id="weekFrom" type="date"></label>
        <label>Hasta <input id="weekTo" type="date"></label>
      </div>
      <div id="daysTabs" class="tabs"></div>
      <div id="dayEditor"></div>
    </section>

    <section class="card">
      <h3>Resumen</h3>
      <label>Adherencia % <input id="sumAdh" type="number" min="0" max="100"></label>
      <label>NEAT/Pasos <input id="sumNeat" type="number" min="0"></label>
      <label>Sensación (1–10) <input id="sumSens" type="number" min="1" max="10"></label>
      <label>Sueño (h) <input id="sumSleep" type="number" step="0.1" min="0"></label>
      <label>Estrés (1–5) <input id="sumStress" type="number" min="1" max="5"></label>
      <label>Comentarios <textarea id="sumNotes"></textarea></label>
      <div class="footer">Datos guardados en el navegador (localStorage)</div>
    </section>
  </div>
</div>

<script>
const storageKey='rutinasFitnessLite';
const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));
const uid=()=>Math.random().toString(36).slice(2)+Date.now().toString(36);
const today=()=>new Date().toISOString().slice(0,10);
let state={alumnos:[]};
let cur={aid:null,wid:null,dia:'lunes'};
const DIAS=['lunes','martes','miercoles','jueves','viernes','sabado','domingo'];

function save(){localStorage.setItem(storageKey,JSON.stringify(state)); renderStudents();}
function load(){const raw=localStorage.getItem(storageKey); if(raw){state=JSON.parse(raw);} else {seed(); save();}}
function seed(){state.alumnos=[demo('Juan Pérez'),demo('Ana García')];}
function demo(nombre){const aid=uid(), wid=uid(); return {id:aid,nombre, semanas:[{id:wid,titulo:'Semana 1',desde:today(),hasta:today(),dias:baseDias(),resumen:baseRes()}]};}
function baseDias(){const d={lunes:[],martes:[],miercoles:[],jueves:[],viernes:[],sabado:[],domingo:[]}; d.lunes.push(exBase('Pecho','Hipertrofia','Press banca',4,'8-12','',90,7,'')); return d;}
function exBase(actividad='',modalidad='',ejercicio='',series=3,reps='10',tiempo='',descanso=60,rpe=7,notas=''){return {id:uid(),actividad,modalidad,ejercicio,series,reps,tiempo,descanso,rpe,notas};}
function baseRes(){return {adh:0,neat:0,sens:5,sleep:0,stress:3,notes:''};}

function renderStudents(){
  const list=$('#studentsList'); const q=$('#searchStudent').value?.toLowerCase()||''; list.innerHTML='';
  state.alumnos.filter(a=>a.nombre.toLowerCase().includes(q)).forEach(a=>{
    const el=document.createElement('div'); el.className='item';
    el.innerHTML=`<div><strong>${a.nombre}</strong><div style="color:var(--muted);font-size:12px">${a.semanas.length} semana(s)</div></div>
    <div style="display:flex;gap:6px">
      <button class="btn" data-k="open">Abrir</button>
      <button class="btn" data-k="dup">Duplicar</button>
      <button class="btn" style="border-color:var(--danger);color:var(--danger)" data-k="del">Borrar</button>
    </div>`;
    el.querySelector('[data-k="open"]').onclick=()=>selectStudent(a.id);
    el.querySelector('[data-k="dup"]').onclick=()=>{const c=JSON.parse(JSON.stringify(a)); c.id=uid(); c.nombre=a.nombre+' (copia)'; c.semanas.forEach(w=>w.id=uid()); state.alumnos.push(c); save();};
    el.querySelector('[data-k="del"]').onclick=()=>{if(confirm('¿Eliminar alumno?')){state.alumnos=state.alumnos.filter(x=>x.id!==a.id); if(cur.aid===a.id){cur={aid:null,wid:null,dia:'lunes'};} save();}};
    list.appendChild(el);
  });
}

function selectStudent(id){
  cur.aid=id; const a=getA(); $('#title').textContent='Rutina de '+a.nombre; $('#subtitle').textContent='Editar semana y días';
  renderWeeks();
}
function renderWeeks(){
  const a=getA(); const sel=$('#weekSelect'); sel.innerHTML=''; a.semanas.forEach(w=>{const o=document.createElement('option');o.value=w.id;o.textContent=w.titulo;sel.appendChild(o)});
  if(!cur.wid){cur.wid=a.semanas[0].id;} sel.value=cur.wid; sel.onchange=()=>{cur.wid=sel.value; renderWeek();};
  $('#newWeek').onclick=()=>{const w={id:uid(),titulo:'Semana '+(a.semanas.length+1),desde:today(),hasta:today(),dias:baseDias(),resumen:baseRes()}; a.semanas.unshift(w); cur.wid=w.id; save(); renderWeeks();};
  renderWeek();
}
function renderWeek(){
  const w=getW(); $('#weekFrom').value=w.desde||''; $('#weekTo').value=w.hasta||'';
  $('#weekFrom').onchange=e=>{w.desde=e.target.value; save();}; $('#weekTo').onchange=e=>{w.hasta=e.target.value; save();};
  renderTabs(); renderDay();
  // resumen
  $('#sumAdh').value=w.resumen.adh||0; $('#sumNeat').value=w.resumen.neat||0; $('#sumSens').value=w.resumen.sens||5; $('#sumSleep').value=w.resumen.sleep||0; $('#sumStress').value=w.resumen.stress||3; $('#sumNotes').value=w.resumen.notes||'';
  ['sumAdh','sumNeat','sumSens','sumSleep','sumStress','sumNotes'].forEach(id=>{$('#'+id).oninput=()=>{const r=w.resumen; r.adh=+$('#sumAdh').value||0; r.neat=+$('#sumNeat').value||0; r.sens=+$('#sumSens').value||5; r.sleep=+$('#sumSleep').value||0; r.stress=+$('#sumStress').value||3; r.notes=$('#sumNotes').value; save();};});
}
function renderTabs(){
  const wrap=$('#daysTabs'); wrap.innerHTML=''; DIAS.forEach(d=>{const b=document.createElement('button'); b.className='tab'+(cur.dia===d?' active':''); b.textContent=d[0].toUpperCase()+d.slice(1); b.onclick=()=>{cur.dia=d; renderTabs(); renderDay();}; wrap.appendChild(b);});}
function renderDay(){
  const w=getW(), d=cur.dia, cont=$('#dayEditor'); cont.innerHTML='';
  (w.dias[d]||[]).forEach((ex,i)=>{cont.appendChild(renderExercise(ex,i,w,d));});
  const add=document.createElement('div'); const btn=document.createElement('button'); btn.className='btn btn-accent'; btn.textContent='Agregar ejercicio'; btn.onclick=()=>{w.dias[d].push(exBase()); save(); renderDay();}; add.appendChild(btn); cont.appendChild(add);
}
function renderExercise(ex,idx,w,d){
  const el=document.createElement('div'); el.className='exercise';
  el.innerHTML=`<div class="ex-row">
    <input placeholder="Actividad/Grupo" value="${ex.actividad||''}" data-k="actividad">
    <input placeholder="Modalidad" value="${ex.modalidad||''}" data-k="modalidad">
    <input placeholder="Ejercicio" value="${ex.ejercicio||''}" data-k="ejercicio">
    <input type="number" min="0" placeholder="Series" value="${ex.series||0}" data-k="series">
    <input placeholder="Reps" value="${ex.reps||''}" data-k="reps">
    <input placeholder="Tiempo (mm:ss)" value="${ex.tiempo||''}" data-k="tiempo">
    <input type="number" min="0" placeholder="Descanso (s)" value="${ex.descanso||0}" data-k="descanso">
    <input type="number" min="1" max="10" placeholder="RPE" value="${ex.rpe||7}" data-k="rpe">
  </div>
  <textarea placeholder="Notas" data-k="notas">${ex.notas||''}</textarea>
  <div style="display:flex;gap:6px;flex-wrap:wrap">
    <button class="btn" data-act="up">↑</button>
    <button class="btn" data-act="down">↓</button>
    <button class="btn" data-act="dup">Duplicar</button>
    <button class="btn" style="border-color:var(--danger);color:var(--danger)" data-act="del">Eliminar</button>
    <button class="btn" data-act="timer">Iniciar descanso</button>
  </div>`;
  // inputs
  el.querySelectorAll('[data-k]').forEach(inp=>{inp.oninput=()=>{const k=inp.dataset.k; ex[k]= (inp.type==='number')? Number(inp.value||0) : inp.value; save();};});
  // acciones
  el.querySelector('[data-act="up"]').onclick=()=>{const arr=w.dias[d]; if(idx>0){[arr[idx-1],arr[idx]]=[arr[idx],arr[idx-1]]; save(); renderDay();}};
  el.querySelector('[data-act="down"]').onclick=()=>{const arr=w.dias[d]; if(idx<arr.length-1){[arr[idx+1],arr[idx]]=[arr[idx],arr[idx+1]]; save(); renderDay();}};
  el.querySelector('[data-act="dup"]').onclick=()=>{const arr=w.dias[d]; const c=JSON.parse(JSON.stringify(ex)); c.id=uid(); arr.splice(idx+1,0,c); save(); renderDay();};
  el.querySelector('[data-act="del"]').onclick=()=>{if(confirm('¿Eliminar ejercicio?')){w.dias[d]=w.dias[d].filter(x=>x.id!==ex.id); save(); renderDay();}};
  el.querySelector('[data-act="timer"]').onclick=()=>{let secs=Number(ex.descanso||60); const id=setInterval(()=>{if(secs<=0){clearInterval(id); alert('¡Descanso finalizado!');} else {document.title='⏱ '+secs+'s'; secs--; }},1000);};
  return el;
}

const getA=()=>state.alumnos.find(a=>a.id===cur.aid)||null;
const getW=()=>{const a=getA(); return a? a.semanas.find(w=>w.id===cur.wid):null;};

// Export/Import/Print
$('#exportBtn').onclick=()=>{const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='rutinas_lite.json'; a.click(); URL.revokeObjectURL(a.href);};
$('#importInput').addEventListener('change',e=>{const f=e.target.files[0]; if(!f) return; const fr=new FileReader(); fr.onload=()=>{try{const data=JSON.parse(fr.result); if(Array.isArray(data.alumnos)){data.alumnos.forEach(n=>{n.id=uid(); n.semanas.forEach(w=>w.id=uid()); state.alumnos.push(n);}); save(); renderAll();} }catch(err){alert('JSON inválido');}}; fr.readAsText(f);});
$('#printBtn').onclick=()=>window.print();

// UI events
$('#addStudent').onclick=()=>{const name=$('#studentName').value.trim(); if(!name){alert('Ingresá un nombre'); return;} const a=demo(name); state.alumnos.unshift(a); $('#studentName').value=''; save(); selectStudent(a.id);};
$('#searchStudent').oninput=renderStudents;

function renderAll(){renderStudents(); if(state.alumnos[0]) selectStudent(state.alumnos[0].id);}
load(); renderAll();
</script>
</body>
</html>
